<div class="container">
  <!-- HEADER + BOT√ìN CONSOLIDADO -->
  <div
    class="headerWrapper"
    style="display: flex; justify-content: space-between; align-items: center"
  >
    <div class="header">
      <h1>üìä Reportes y Estad√≠sticas</h1>
      <p>Genera y exporta reportes del sistema</p>
    </div>

    <div>
      <button class="btnGenerar" (click)="generarConsolidado()">
        GENERAR CONSOLIDADO DE PRODUCTOS
      </button>
    </div>
  </div>

  @if (showModal() && datosProductoConsolidado()) {
  <div
    class="fixed inset-0 bg-black/20 flex items-center justify-center z-1000 p-5"
    (click)="showModal.set(false)"
  >
    <div
      class="bg-white rounded-xl max-w-[700px] w-full max-h-[90vh] overflow-y-auto shadow-[0_10px_40px_rgba(0,0,0,0.3)] p-5"
      (click)="$event.stopPropagation()"
    >
      <!-- HEADER -->
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Detalle de Productos a Alistar</h2>
        <button class="text-gray-500 hover:text-gray-800 font-bold" (click)="showModal.set(false)">
          ‚úï
        </button>
      </div>

      <!-- TABLA CON SCROLL -->
      <div class="overflow-x-auto max-h-[60vh] overflow-y-auto border rounded-md">
        <table class="min-w-full border border-gray-200">
          <thead class="bg-gray-100 sticky top-0 z-10">
            <tr>
              <th class="px-4 py-2 text-left border-b">Producto</th>
              <th class="px-4 py-2 text-right border-b">Cantidad</th>
              <th class="px-4 py-2 text-right border-b">Stock Actual</th>
              <th class="px-4 py-2 text-center border-b">Stock Minimo</th>
              <th class="px-4 py-2 text-center border-b">Estado</th>
            </tr>
          </thead>

          <tbody>
            @for (datosProd of datosProductoConsolidado(); track $index) {
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-2 border-b">{{ datosProd.nombreProducto }}</td>
              <td class="px-4 py-2 text-right border-b">{{ datosProd.totalProductos }}</td>
              <td class="px-4 py-2 text-right border-b">{{ datosProd.stockActual }}</td>
              <td class="px-4 py-2 text-center border-b">{{ datosProd.stockMinimo }}</td>
              <td class="px-4 py-2 text-center border-b">{{ datosProd.estado }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- FOOTER -->
      <div class="mt-4 flex justify-end">
        <button
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
          (click)="showModal.set(false)"
        >
          Cerrar
        </button>
      </div>
    </div>
  </div>
  } @if (error()) {
  <div class="errorMessage">{{ error() }}</div>
  }

  <div class="controlPanel">
    <div class="formGroup">
      <label>Tipo de Reporte</label>
      <select
        #inputSearch
        [value]="tipoReporte()"
        (change)="tipoReporte.set(inputSearch.value)"
        class="select"
      >
        <option value="ventas-periodo">Ventas por Periodo</option>
        <option value="ventas-vendedor">Ventas por Vendedor</option>
        <option value="productos-vendidos">Productos M√°s Vendidos</option>
        <option value="clientes">Reporte de Clientes</option>
        <option value="boletas">Boletas Emitidas</option>
      </select>
    </div>

    @if (tipoReporte() !== 'clientes') {
    <div class="formGroup">
      <label>Fecha Inicio</label>
      <input
        #inputFecha
        type="date"
        [value]="fechaInicio()"
        (input)="fechaInicio.set(inputFecha.value)"
        class="input"
      />
    </div>

    <div class="formGroup">
      <label>Fecha Fin</label>
      <input
        #inputFechaFin
        type="date"
        [value]="fechaFin()"
        (input)="fechaFin.set(inputFechaFin.value)"
        class="input"
      />
    </div>
    }

    <div class="buttonGroup">
      <button (click)="generarReporte()" class="btnGenerar" [disabled]="loading()">
        {{ loading() ? '‚è≥ Generando...' : 'üîç Generar Reporte' }}
      </button>

      @if (datos().length > 0) {
      <button (click)="exportarAExcel()" class="btnExcel">üìó Exportar Excel</button>
      <button (click)="exportarAPDF()" class="btnPDF">üìï Exportar PDF</button>
      }
    </div>
  </div>

  @if (loading()) {
  <div class="loading">
    <div class="spinner"></div>
    <p>Generando reporte...</p>
  </div>
  } @if (!loading() && datos().length > 0) {
  <div class="reporteContainer">
    <div class="reporteHeader">
      <h2>{{ getTituloReporte() }}</h2>
      <p>
        Total de registros: <strong>{{ datos().length }}</strong>
      </p>
    </div>

    <div class="tableContainer">
      {{ renderTabla() }}
    </div>
  </div>
  } @else if (!loading() && datos().length === 0 && tipoReporte()) {
  <div class="noData">
    <p>üì≠ No hay datos disponibles para el periodo seleccionado</p>
  </div>
  }
</div>
