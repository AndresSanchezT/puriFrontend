<div class="container mx-auto p-4">
  <!-- HEADER + BOT√ìN CONSOLIDADO -->
  <div class="flex justify-between items-start mb-6">
    <div>
      <h1 class="text-2xl font-bold">üìä Reportes y Estad√≠sticas</h1>
      <p class="text-gray-600">Genera y exporta reportes del sistema</p>
    </div>

    <div class="flex flex-row gap-2">
      <button class="btnGenerar" (click)="generarConsolidado()">
        GENERAR CONSOLIDADO DE PRODUCTOS DE MA√ëANA
      </button>

      <button class="btnResetear" (click)="resetearProductosFaltantes()">
        RESETEAR PRODUCTOS FALTANTES
      </button>
    </div>
  </div>
  <!-- MODAL DEL CONSOLIDADO -->
  @if (showModal()) {
  <div
    class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    (click)="showModal.set(false)"
  >
    <div
      class="bg-white rounded-xl w-full max-w-3xl max-h-[90vh] shadow-xl p-5 overflow-y-auto"
      (click)="$event.stopPropagation()"
    >
      <!-- HEADER MODAL -->
      <div class="flex justify-between items-center mb-5 border-b pb-3">
        <h2 class="text-xl font-semibold text-gray-800">Detalle de Productos a Alistar</h2>
        <button
          class="text-gray-500 hover:text-gray-800 text-2xl leading-none"
          (click)="showModal.set(false)"
        >
          ‚úï
        </button>
      </div>

      <!-- LOADING -->
      @if (loadingConsolidado()) {
      <div class="py-6 text-center text-gray-500">‚è≥ Cargando datos...</div>
      }

      <!-- SIN DATOS -->
      @else if (consolidadoConFaltantes().length === 0) {
      <div class="py-6 text-center text-gray-500">üì≠ No hay datos disponibles</div>
      }

      <!-- TABLA -->
      @else {
      <div class="overflow-y-auto max-h-[60vh] border rounded-md">
        <table class="min-w-full">
          <thead class="bg-gray-100 sticky top-0">
            <tr class="text-left">
              <th class="px-4 py-2 border-b">Producto</th>
              <th class="px-4 py-2 border-b text-right">Cantidad</th>
              <th class="px-4 py-2 border-b text-right">Stock Actual</th>
              <th class="px-4 py-2 border-b text-center">Faltantes</th>
              <th class="px-4 py-2 border-b text-center">Estado</th>
            </tr>
          </thead>

          <tbody>
            @for (p of consolidadoConFaltantes(); track p.nombreProducto) {
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-2 border-b">{{ p.nombreProducto }}</td>
              <td class="px-4 py-2 border-b text-right">{{ p.totalProductos }}</td>
              <td class="px-4 py-2 border-b text-right">{{ p.stockActual }}</td>
              <td class="px-4 py-2 border-b text-center">{{ p.cantidadFaltante }}</td>
              <td class="px-4 py-2 border-b text-center">{{ p.estado }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }

      <!-- FOOTER MODAL CON BOTONES -->
      <div class="mt-5 flex justify-end gap-3">
        @if (consolidadoConFaltantes().length > 0) {
        <button
          class="bg-red-600 text-white px-5 py-2 rounded-md hover:bg-red-700 transition-colors flex items-center gap-2"
          (click)="generarPDFListaProductos()"
        >
          <span>üìÑ</span>
          <span>Imprimir Lista</span>
        </button>
        }

        <button
          class="bg-blue-600 text-white px-5 py-2 rounded-md hover:bg-blue-700 transition-colors"
          (click)="showModal.set(false)"
        >
          Cerrar
        </button>
      </div>
    </div>
  </div>
  }

  <!-- ERRORES -->
  @if (error()) {
  <div class="bg-red-100 border border-red-400 text-red-600 px-4 py-2 rounded my-4">
    {{ error() }}
  </div>
  }

  <!-- PANEL DE CONTROL -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 bg-white p-4 rounded-lg shadow-sm">
    <!-- Tipo reporte -->
    <div class="formGroup">
      <label class="block text-sm font-medium mb-1">Tipo de Reporte</label>
      <select
        #inputSearch
        class="select w-full"
        [value]="tipoReporte()"
        (change)="tipoReporte.set(inputSearch.value)"
      >
        <option value="ventas-periodo">Ventas por Periodo</option>
        <option value="ventas-vendedor">Ventas por Vendedor</option>
        <option value="productos-vendidos">Productos M√°s Vendidos</option>
        <option value="clientes">Reporte de Clientes</option>
        <option value="boletas">Boletas Emitidas</option>
      </select>
    </div>

    <!-- Fecha inicio -->
    @if (tipoReporte() !== 'clientes') {
    <div class="formGroup">
      <label class="block text-sm font-medium mb-1">Fecha Inicio</label>
      <input
        #inputFecha
        type="date"
        class="input w-full"
        [value]="fechaInicio()"
        (input)="fechaInicio.set(inputFecha.value)"
      />
    </div>

    <!-- Fecha fin -->
    <div class="formGroup">
      <label class="block text-sm font-medium mb-1">Fecha Fin</label>
      <input
        #inputFechaFin
        type="date"
        class="input w-full"
        [value]="fechaFin()"
        (input)="fechaFin.set(inputFechaFin.value)"
      />
    </div>
    }
  </div>

  <!-- BOTONES -->
  <div class="flex gap-3 mb-6">
    <button class="btnGenerar" [disabled]="loading()" (click)="exportarAPDF('hoy')">
      {{ loading() ? '‚è≥ Generando...' : 'üîç GENERAR REPORTE BOLETAS DE HOY CON DATOS' }}
    </button>

    <button class="btnManana" [disabled]="loading()" (click)="exportarAPDF('manana')">
      {{ loading() ? '‚è≥ Generando...' : 'üîç GENERAR REPORTE BOLETAS DE MA√ëANA' }}
    </button>

  </div>

  <!-- LOADING REPORTES -->
  @if (loading()) {
  <div class="text-center my-5">
    <div class="spinner mx-auto mb-2"></div>
    <p class="text-gray-600">Generando reporte...</p>
  </div>
  }

  <!-- RESULTADOS -->
  @if (!loading() && datos().length > 0) {
  <div class="bg-white p-5 rounded-lg shadow">
    <div class="mb-4">
      <h2 class="text-xl font-bold">{{ getTituloReporte() }}</h2>
      <p class="text-gray-600">
        Total de registros: <strong>{{ datos().length }}</strong>
      </p>
    </div>

    <div class="tableContainer">hola</div>
  </div>
  }

  <!-- NO DATA -->
  @else if (!loading() && datos().length === 0 && tipoReporte()) {
  <div class="text-center text-gray-600 py-10">
    üì≠ No hay datos disponibles para el periodo seleccionado
  </div>
  }
</div>
